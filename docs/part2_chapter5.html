

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 5: Padding and Exposing Signals &#8212; Introduction to Chiquito</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'part2_chapter5';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 1: MiMC7 Concepts" href="part3_chapter1.html" />
    <link rel="prev" title="Chapter 4: Multiple StepTypes" href="part2_chapter4.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="landing_page.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/pselogo.png" class="logo__image only-light" alt="Introduction to Chiquito - Home"/>
    <script>document.write(`<img src="_static/pselogo.png" class="logo__image only-dark" alt="Introduction to Chiquito - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="landing_page.html">
                    Meet Chiquito
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Intro to Chiquito</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part1_chapter1.html">What is Zero Knowledge Proof (Developer POV)?</a></li>
<li class="toctree-l1"><a class="reference internal" href="part1_chapter2.html">What is Chiquito?</a></li>
<li class="toctree-l1"><a class="reference internal" href="part1_chapter3.html">Chiquito Programming Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="part1_chapter4.html">Python Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="part1_chapter5.html">Setup</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Fibonacci Example</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part2_chapter1.html">Chapter 1: Fibonacci and Chiquito Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2_chapter2.html">Chapter 2: StepType and Circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2_chapter3.html">Chapter 3: Witness</a></li>
<li class="toctree-l1"><a class="reference internal" href="part2_chapter4.html">Chapter 4: Multiple StepTypes</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 5: Padding and Exposing Signals</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - MiMC7 Example</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part3_chapter1.html">Chapter 1: MiMC7 Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3_chapter2.html">Chapter 2: First Attempt</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3_chapter3.html">Chapter 3: Witness</a></li>
<li class="toctree-l1"><a class="reference internal" href="part3_chapter4.html">Chapter 4: Fixed Signals, Lookup Tables, and Super Circuit</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="appendix_chapter1.html">Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_chapter2.html">Chiquito vs Halo2</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix_chapter3.html">Chiquito architecture</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/privacy-scaling-explorations/chiquito" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/privacy-scaling-explorations/chiquito/issues/new?title=Issue%20on%20page%20%2Fpart2_chapter5.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/part2_chapter5.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 5: Padding and Exposing Signals</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#padding">Padding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exposing-signals">Exposing Signals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-up-the-concepts">Coding up the Concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-everything-together">Putting Everything Together</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-5-padding-and-exposing-signals">
<h1>Chapter 5: Padding and Exposing Signals<a class="headerlink" href="#chapter-5-padding-and-exposing-signals" title="Permalink to this heading">#</a></h1>
<p>In prior examples, all Fibonacci circuit witnesses have the same number of step instances. According to our analogy where a circuit is considered a piece of hardware and its witnesses compatible softwares, it’s natural to think that we’d allow for more flexibility for our witnesses. Most immediately, and we shouldn’t limit all Fibonacci circuit witnesses to have the same number of step instances.</p>
<p>However, you might wonder, doesn’t <code class="docutils literal notranslate"><span class="pre">self.pragma_num_steps(4)</span></code> limit the number of step instances to 4? Besides, doesn’t this function guarantee the Fibonacci circuit’s security, such that we have a fixed circuit setup with a specific number of step instances, thereby making the circuit a piece of “hardware” that cannot be tampered with? How can we allow for BOTH a fixed circuit setup AND flexible witnesses? This problem is frequently encountered in projects like PSE’s zkEVM, where witnesses with very different sizes are passed into the same circuit.</p>
<section id="padding">
<h2>Padding<a class="headerlink" href="#padding" title="Permalink to this heading">#</a></h2>
<p>In Chiquito, you can achieve fixed circuit setup with flexible witnesses through a technique called “padding”:</p>
<ul class="simple">
<li><p>To have a fixed circuit setup, we specify a maximum number of steps that won’t be exceeded by all plausible witnesses. For example, we can set this number to 10 for the Fibonacci circuit, but it’s really up to you.</p></li>
<li><p>To have flexible witnesses that still pass the same circuit setup, we add “padding step instances” towards the end of the witness.</p></li>
<li><p>For example, if we want to calculate 4 rounds for the Fibonacci series, we add 6 padding step instances:</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Step Type</p></th>
<th class="head text-center"><p>Step Instance Index</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p>Signals</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p>Setups</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>a</p></td>
<td class="text-center"><p>b</p></td>
<td class="text-center"><p>c</p></td>
<td class="text-center"><p>constraint 1</p></td>
<td class="text-center"><p>constraint 2</p></td>
<td class="text-center"><p>constraint 3</p></td>
<td class="text-center"><p>constraint 4</p></td>
<td class="text-center"><p>constraint 5</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo first step</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>a == 1</p></td>
<td class="text-center"><p>b == 1</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>4</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>9</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>If we want 7 rounds, we add 3 padding step instances.</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Step Type</p></th>
<th class="head text-center"><p>Step Instance Index</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p>Signals</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p>Setups</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>a</p></td>
<td class="text-center"><p>b</p></td>
<td class="text-center"><p>c</p></td>
<td class="text-center"><p>constraint 1</p></td>
<td class="text-center"><p>constraint 2</p></td>
<td class="text-center"><p>constraint 3</p></td>
<td class="text-center"><p>constraint 4</p></td>
<td class="text-center"><p>constraint 5</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo first step</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>a == 1</p></td>
<td class="text-center"><p>b == 1</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>4</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>13</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>13</p></td>
<td class="text-center"><p>21</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p>13</p></td>
<td class="text-center"><p>21</p></td>
<td class="text-center"><p>34</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>9</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
</tbody>
</table>
</section>
<section id="exposing-signals">
<h2>Exposing Signals<a class="headerlink" href="#exposing-signals" title="Permalink to this heading">#</a></h2>
<p>In prior examples, the witnesses we generate are all PRIVATE by default. While they are visible to the prover, or in the context of Chiquito, the writer of <code class="docutils literal notranslate"><span class="pre">trace</span></code> function, they are not visible to the verifier. However, it’s common in zero knowledge proof systems to expose some witness values to both the prover and the verifier. Common examples include output of a hash function or the root of a Merkle tree.</p>
<p>For pure demonstration purpose, say that we want to expose the result of our Fibonacci calculation after an arbitrary number of <code class="docutils literal notranslate"><span class="pre">n</span></code> rounds (where n &lt;= 10). We also want to expose the round number <code class="docutils literal notranslate"><span class="pre">n</span></code>. Because we need to specify which instance of the signal to expose and because we want to allow for witnesses with arbitrary number of step instances, we cannot expose a specific step instance. Rather, the best practice is to copy over the Fibonacci result for all padding steps and <code class="docutils literal notranslate"><span class="pre">n</span></code> for all steps through the last step and expose the last step instance.</p>
<p>Building on top of the table example above where <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">7</span></code>, we create a new signal <code class="docutils literal notranslate"><span class="pre">n</span></code> and populate the three padding step instances:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p>Step Type</p></th>
<th class="head text-center"><p>Step Instance Index</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p>Signals</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p>Setups</p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
<th class="head text-center"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>a</p></td>
<td class="text-center"><p>b</p></td>
<td class="text-center"><p>c</p></td>
<td class="text-center"><p>n</p></td>
<td class="text-center"><p>constraint 1</p></td>
<td class="text-center"><p>constraint 2</p></td>
<td class="text-center"><p>constraint 3</p></td>
<td class="text-center"><p>constraint 4</p></td>
<td class="text-center"><p>constraint 5</p></td>
<td class="text-center"><p>constraint 6</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo first step</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>a == 1</p></td>
<td class="text-center"><p>b == 1</p></td>
<td class="text-center"><p>n == n.next</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>3</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>4</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>13</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>5</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>13</p></td>
<td class="text-center"><p>21</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>fibo step</p></td>
<td class="text-center"><p>6</p></td>
<td class="text-center"><p>13</p></td>
<td class="text-center"><p>21</p></td>
<td class="text-center"><p>34</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>a + b == c</p></td>
<td class="text-center"><p>b == a.next</p></td>
<td class="text-center"><p>c == b.next</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>21</p></td>
<td class="text-center"><p>34</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>b == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>8</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>34</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>b == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>padding</p></td>
<td class="text-center"><p>9</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>34</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>7</p></td>
<td class="text-center"><p>n == n.next</p></td>
<td class="text-center"><p>b == b.next</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
<td class="text-center"><p>n.a.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="coding-up-the-concepts">
<h2>Coding up the Concepts<a class="headerlink" href="#coding-up-the-concepts" title="Permalink to this heading">#</a></h2>
<p>Now that we introduced padding and exposing signals, let’s express the table above in a Chiquito circuit.</p>
<p>First, let’s add the padding step type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Padding</span><span class="p">(</span><span class="n">StepType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">wg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span><span class="p">,</span> <span class="n">n_value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">a_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">n_value</span><span class="p">))</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">setup</span></code>, we added two transition constraints.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">==</span> <span class="pre">b.next</span></code> copies the Fibonacci result after <code class="docutils literal notranslate"><span class="pre">n</span></code> rounds through the last padding step. Note that “b” in the first <code class="docutils literal notranslate"><span class="pre">Padding</span></code> step instance equals “c” in the last <code class="docutils literal notranslate"><span class="pre">FiboStep</span></code> instance, which is the final result.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">n.next</span></code> copies the <code class="docutils literal notranslate"><span class="pre">n</span></code> for exposing at the last step instance. Note that exposing <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span></code> is done at the circuit level <code class="docutils literal notranslate"><span class="pre">setup</span></code>, which we leave for later.</p></li>
</ul>
<p>Note that the new signal <code class="docutils literal notranslate"><span class="pre">n</span></code> is not added in <code class="docutils literal notranslate"><span class="pre">setup</span></code>, because it’ll be a forward signal to be added in circuit level <code class="docutils literal notranslate"><span class="pre">setup</span></code>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">wg</span></code>, we assign <code class="docutils literal notranslate"><span class="pre">a_value</span></code>, <code class="docutils literal notranslate"><span class="pre">b_value</span></code>, and <code class="docutils literal notranslate"><span class="pre">n_value</span></code> to their corresponding signals. We assign <code class="docutils literal notranslate"><span class="pre">a_value</span></code>, although it’s not exposed in the last padding step, because the last <code class="docutils literal notranslate"><span class="pre">FiboStep</span></code> instance constraints <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">==</span> <span class="pre">a.next</span></code>.</p>
<p>Second, let’s modify all existing step types to account for the new signal <code class="docutils literal notranslate"><span class="pre">n</span></code>, basically adding a new constraint <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">n.next</span></code> in <code class="docutils literal notranslate"><span class="pre">setup</span></code> and assigning <code class="docutils literal notranslate"><span class="pre">n_value</span></code> in <code class="docutils literal notranslate"><span class="pre">wg</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FiboFirstStep</span><span class="p">(</span><span class="n">StepType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">wg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span><span class="p">,</span> <span class="n">n_value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="c1"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">n_value</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">FiboStep</span><span class="p">(</span><span class="n">StepType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">wg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span><span class="p">,</span> <span class="n">n_value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="c1"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">n_value</span><span class="p">))</span>
</pre></div>
</div>
<p>Third, let’s modify the circuit <code class="docutils literal notranslate"><span class="pre">setup</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Fibonacci</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fibo_first_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="p">(</span><span class="n">FiboFirstStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fibo_first_step&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fibo_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="p">(</span><span class="n">FiboStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fibo_step&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="p">(</span><span class="n">Padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;padding&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pragma_num_steps</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pragma_first_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fibo_first_step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pragma_last_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">Last</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">Last</span><span class="p">())</span>
        
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="c1"># TODO</span>
</pre></div>
</div>
<p>The code above did a few things:</p>
<ul class="simple">
<li><p>Add forward signal <code class="docutils literal notranslate"><span class="pre">n</span></code> and append it to the circuit</p></li>
<li><p>Add padding step and append it to the circuit</p></li>
<li><p>Modify <code class="docutils literal notranslate"><span class="pre">pragma_num_steps</span></code> to <code class="docutils literal notranslate"><span class="pre">10</span></code>, the maximum number of steps that won’t be exceeded by all plausible witnesses</p></li>
<li><p>Constrain that the last step instance is <code class="docutils literal notranslate"><span class="pre">Padding</span></code></p></li>
<li><p>Expose the last instances of signals <code class="docutils literal notranslate"><span class="pre">b</span></code> (the final Fibonacci result) and <code class="docutils literal notranslate"><span class="pre">n</span></code> (the number of non-padding step instances). <code class="docutils literal notranslate"><span class="pre">self.expose</span></code> takes two parameters: the signal to expose and the step instance of the signal to expose. In the example above <code class="docutils literal notranslate"><span class="pre">Last()</span></code> means the last step instance. In Chiquito, you can also specify <code class="docutils literal notranslate"><span class="pre">First()</span></code> for the first step instance or <code class="docutils literal notranslate"><span class="pre">Step(index)</span></code> for the step instance at a specific <code class="docutils literal notranslate"><span class="pre">index</span></code>.</p></li>
</ul>
<p>Finally, we instantiate step instances and generate witness using <code class="docutils literal notranslate"><span class="pre">trace</span></code>, with the following step instance combination:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FiboFirstStep</span></code> for the 1st step instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FiboStep</span></code> for the 2nd through n-th step instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Padding</span></code> for the rest step instances such that there are 10 step instances in total, as specified by <code class="docutils literal notranslate"><span class="pre">self.pragma_num_steps(10)</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Fibonacci</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ...</span>
        
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fibo_first_step</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fibo_step</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
            <span class="n">prev_a</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="n">prev_a</span>
        <span class="k">while</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">needs_padding</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<p>In the code above, we added a new parameter <code class="docutils literal notranslate"><span class="pre">n</span></code> for <code class="docutils literal notranslate"><span class="pre">trace</span></code>, which is the user’s input when calling <code class="docutils literal notranslate"><span class="pre">gen_witness</span></code>. <code class="docutils literal notranslate"><span class="pre">n</span></code> is passed into <code class="docutils literal notranslate"><span class="pre">self.add</span></code> as an input parameter to instantiate different step types. Again, note the matching relationship of witness generation parameters between <code class="docutils literal notranslate"><span class="pre">self.add</span></code> and <code class="docutils literal notranslate"><span class="pre">wg</span></code>:</p>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">self.add(self.fibo_first_step,</span> <span class="pre">(1,</span> <span class="pre">1,</span> <span class="pre">n))</span></code>, <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">1,</span> <span class="pre">n)</span></code> correspond to <code class="docutils literal notranslate"><span class="pre">a_value,</span> <span class="pre">b_value,</span> <span class="pre">n_value</span></code> in <code class="docutils literal notranslate"><span class="pre">FiboFirstStep</span></code> <code class="docutils literal notranslate"><span class="pre">wg</span></code></p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">self.add(self.fibo_step,</span> <span class="pre">(a,</span> <span class="pre">b,</span> <span class="pre">n))</span></code>, <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b,</span> <span class="pre">n)</span></code> correspond to <code class="docutils literal notranslate"><span class="pre">a_value,</span> <span class="pre">b_value,</span> <span class="pre">n_value</span></code> in <code class="docutils literal notranslate"><span class="pre">FiboStep</span></code> <code class="docutils literal notranslate"><span class="pre">wg</span></code></p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">self.add(self.padding,</span> <span class="pre">(a,</span> <span class="pre">b,</span> <span class="pre">n))</span></code>, <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b,</span> <span class="pre">n)</span></code> correspond to <code class="docutils literal notranslate"><span class="pre">a_value,</span> <span class="pre">b_value,</span> <span class="pre">n_value</span></code> in <code class="docutils literal notranslate"><span class="pre">Padding</span></code> <code class="docutils literal notranslate"><span class="pre">wg</span></code></p></li>
</ul>
</section>
<section id="putting-everything-together">
<h2>Putting Everything Together<a class="headerlink" href="#putting-everything-together" title="Permalink to this heading">#</a></h2>
<p>Putting all pieces together, we have the following circuit, which allows for a fixed circuit setup with 10 step instances, as well as flexible witnesses with an arbitrary number of <code class="docutils literal notranslate"><span class="pre">n</span></code> step instances up to 10, filled with <code class="docutils literal notranslate"><span class="pre">Padding</span></code> step instances if fewer than 10:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chiquito.dsl</span> <span class="kn">import</span> <span class="n">Circuit</span><span class="p">,</span> <span class="n">StepType</span>
<span class="kn">from</span> <span class="nn">chiquito.cb</span> <span class="kn">import</span> <span class="n">eq</span>
<span class="kn">from</span> <span class="nn">chiquito.util</span> <span class="kn">import</span> <span class="n">F</span>
<span class="kn">from</span> <span class="nn">chiquito.chiquito_ast</span> <span class="kn">import</span> <span class="n">Last</span>

<span class="k">class</span> <span class="nc">FiboFirstStep</span><span class="p">(</span><span class="n">StepType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constr</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constr</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constr</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">wg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span><span class="p">,</span> <span class="n">n_value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">a_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">a_value</span> <span class="o">+</span> <span class="n">b_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">n_value</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">FiboStep</span><span class="p">(</span><span class="n">StepType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constr</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">wg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span><span class="p">,</span> <span class="n">n_value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">a_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">a_value</span> <span class="o">+</span> <span class="n">b_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">n_value</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Padding</span><span class="p">(</span><span class="n">StepType</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">next</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">wg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">a_value</span><span class="p">,</span> <span class="n">b_value</span><span class="p">,</span> <span class="n">n_value</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">a_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">n_value</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Fibonacci</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fibo_first_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="p">(</span><span class="n">FiboFirstStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fibo_first_step&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fibo_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="p">(</span><span class="n">FiboStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fibo_step&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_type</span><span class="p">(</span><span class="n">Padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;padding&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pragma_num_steps</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pragma_first_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fibo_first_step</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pragma_last_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">Last</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">Last</span><span class="p">())</span>
        
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fibo_first_step</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fibo_step</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
            <span class="n">prev_a</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">b</span> <span class="o">+=</span> <span class="n">prev_a</span>
        <span class="k">while</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">needs_padding</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We initialize the circuit, generate a witness with 7 fibo first and fibo step instances (plus 3 padding step instances), and print the witness:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fibo</span> <span class="o">=</span> <span class="n">Fibonacci</span><span class="p">()</span>
<span class="n">fibo_witness</span> <span class="o">=</span> <span class="n">fibo</span><span class="o">.</span><span class="n">gen_witness</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fibo_witness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TraceWitness(
	step_instances={
		StepInstance(
			step_type_uuid=222694954373723398179275332012349196810,
			assignments={
				a = 1,
				b = 1,
				c = 2,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695007139679632678500855005741451786,
			assignments={
				a = 1,
				b = 2,
				c = 3,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695007139679632678500855005741451786,
			assignments={
				a = 2,
				b = 3,
				c = 5,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695007139679632678500855005741451786,
			assignments={
				a = 3,
				b = 5,
				c = 8,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695007139679632678500855005741451786,
			assignments={
				a = 5,
				b = 8,
				c = 13,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695007139679632678500855005741451786,
			assignments={
				a = 8,
				b = 13,
				c = 21,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695007139679632678500855005741451786,
			assignments={
				a = 13,
				b = 21,
				c = 34,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695035344905487756608697482085009930,
			assignments={
				a = 21,
				b = 34,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695035344905487756608697482085009930,
			assignments={
				a = 21,
				b = 34,
				n = 7
			},
		),
		StepInstance(
			step_type_uuid=222695035344905487756608697482085009930,
			assignments={
				a = 21,
				b = 34,
				n = 7
			},
		)
	},
)
</pre></div>
</div>
</div>
</div>
<p>Generate and verify proof with this witness. Should return <code class="docutils literal notranslate"><span class="pre">Ok(())</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fibo</span><span class="o">.</span><span class="n">halo2_mock_prover</span><span class="p">(</span><span class="n">fibo_witness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ok(
    (),
)
</pre></div>
</div>
</div>
</div>
<p>Generate another witness with 4 fibo first and fibo step instances (plus 6 padding step instances) and verify. Should return <code class="docutils literal notranslate"><span class="pre">Ok(())</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">another_fibo_witness</span> <span class="o">=</span> <span class="n">fibo</span><span class="o">.</span><span class="n">gen_witness</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">fibo</span><span class="o">.</span><span class="n">halo2_mock_prover</span><span class="p">(</span><span class="n">another_fibo_witness</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ok(
    (),
)
</pre></div>
</div>
</div>
</div>
<p>In this chapter, we learned how to construct a circuit with a fixed setup but flexible witnesses. Specifically, we fixed the number of step instances for the circuit setup but allowed for arbitrary numbers of step instances for the witnesses, by allowing the user to customize witnesses with parameter <code class="docutils literal notranslate"><span class="pre">n</span></code>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "chiquito_kernel"
        },
        kernelOptions: {
            name: "chiquito_kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'chiquito_kernel'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="part2_chapter4.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 4: Multiple StepTypes</p>
      </div>
    </a>
    <a class="right-next"
       href="part3_chapter1.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 1: MiMC7 Concepts</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#padding">Padding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exposing-signals">Exposing Signals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-up-the-concepts">Coding up the Concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#putting-everything-together">Putting Everything Together</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Leo Lara, Steve Wang
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>